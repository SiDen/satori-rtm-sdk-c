<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTM Core SDK: C SDK for Satori Platform</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
     <a class="page-logo-link" href="https://www.satori.com" style="cursor: pointer;">
       <img alt="Satori"
            class="page-logo-image"
            height="30"
            src="https://www.satori.com/assets/images/logo-light@2x.png"
            width="177"
       />
     </a>
     RTM Core SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C SDK for Satori Platform </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This C SDK is a lightweight SDK:</p><ul>
<li>It has no external dependencies, in particular it does not require a JSON library</li>
<li>It does not lock you into using any threading or event loop framework, but is ready to be used in any of those</li>
<li>Does not allocate memory dynamically. All message processing is done in-place</li>
<li>Has less features than other Satori SDKs, e.g. it has no auto-reconnection</li>
<li>Is likely to be used as a base for building higher-level SDKs (see ios-framework for example)</li>
</ul>
<h1>Build </h1>
<h2>For desktop/server </h2>
<p>The build system is using <a href="https://cmake.org/">cmake</a>.</p>
<p>To build, just execute: </p><div class="fragment"><div class="line">$ mkdir build &amp;&amp; cd build</div><div class="line">$ cmake ..</div><div class="line">$ cmake --build .</div></div><!-- fragment --><p>To build with tests, execute: </p><div class="fragment"><div class="line">$ cmake .. -Dtest=1</div><div class="line">$ cmake --build .</div></div><!-- fragment --><p>To run the unit tests, first you need to create a credentials.json file: </p><div class="fragment"><div class="line">$ cat credentials.json</div><div class="line">{</div><div class="line">  &quot;endpoint&quot;: &quot;wss://&lt;SATORI_HOST&gt;/&quot;,</div><div class="line">  &quot;appkey&quot;: &quot;&lt;APP KEY&gt;&quot;</div><div class="line">}</div></div><!-- fragment --><p> after that, execute: </p><div class="fragment"><div class="line">$ ./core/test/rtm_unit_tests</div></div><!-- fragment --><h2>TLS support </h2>
<p>The SDK can take advantage of either OpenSSL, GNUTLS or Apple SSL API for supporting secure (wss://) connections. To enable that, pass one of "-DUSE_OPENSSL=ON", "-DUSE_GNUTLS=ON" or "-DUSE_APPLE_SSL=ON" respectively to CMake.</p>
<h2>RTM Framework for iOS</h2>
<p>The SatoriSDK framework for iOS enables you to easily integrate your iOS apps with Satori. Using the framework, you can publish and subscribe messages to RTM. There are multiple ways for installing the SatoriSDK framework in your own project.</p>
<h3>Installation with CocoaPods</h3>
<p>The SatoriSDK is available as a <a href="http://cocoapods.org">CocoaPod</a>. Cocoapod is a dependency manager for iOS, which automates and simplifies the process of using 3rd-party frameworks like SatoriSDK in your projects. Make sure cocoapods is installed. Then create a podfile for your project if it doesn't already exist. To install the SDK:</p>
<ol type="1">
<li>Open your Podfile and add the following dependency in the <code>target "&lt;your_app_target&gt;" do</code> section: <div class="fragment"><div class="line">use_frameworks!</div><div class="line">pod &#39;SatoriSDK&#39;, :git =&gt; &quot;https://github.com/satori-com/satori-sdk-c.git&quot;</div></div><!-- fragment --></li>
<li>Save your Podfile.</li>
<li>Run <code>pod install</code> from command line.</li>
</ol>
<p>You've now installed the SatoriSDK framework. Refer to <em>Framework API usage</em> section to get started.</p>
<h3>Manual installation using Source code</h3>
<p>Create a local repository by cloning the satori-sdk-c to your chosen location. Then,</p>
<h4>Step 1: Build framework</h4>
<p>There are two options to build the RTM framework for iOS:</p>
<p><b>Option 1</b> - <em>Build directly from command-line</em></p>
<div class="fragment"><div class="line">$ cd ios-framework/SatoriSDK</div><div class="line">$ xcodebuild -project SatoriSDK.xcodeproj -scheme SatoriSDK-Universal -config &lt;config-name&gt; # where &lt;config-name&gt; can be Debug or Release. Default is Debug if -config option is not specified.</div></div><!-- fragment --><p> <b>Option 2</b> - <em>Build in Xcode IDE</em> </p><div class="fragment"><div class="line">$ open SatoriSDK.xcodeproj</div><div class="line">$ # Select SatoriSDK-Universal target and build.</div></div><!-- fragment --><p> The SatoriSDK.framework will be built under ios-framework/build directory.</p>
<h4>Step 2: Add framework to your project</h4>
<p>Once you build the framework, open your app's Xcode project and drag-and-drop the framework under "Embedded Binaries" section under the app's target. Choose "Copy items if needed" and "Create groups" in the dialog box.</p>
<h3>Framework API usage</h3>
<p>The SatoriSDK.framework provides you with both Objective-C and C APIs to integrate within your app. Use <code>#import &lt;SatoriSDK/SatoriSDK.h&gt;</code> in your application class to make use of these APIs. The Objective-C specific APIs are located in <code>SatoriRtmConnection.h</code> and C APIs can be found in <code><a class="el" href="rtm_8h.html" title="RTM CORE SDK documentation. ">rtm.h</a></code></p>
<h5>Objective-C Sample Code</h5>
<div class="fragment"><div class="line">// create a new rtm instance with url and appKey</div><div class="line">SatoriRtmConnection *rtm = [[SatoriRtmConnection alloc] initWithUrl:&quot;url&quot; andAppkey:&quot;appkey&quot;];</div><div class="line"></div><div class="line">// connect to rtm and provide pdu data handler block</div><div class="line">rtm_status status = [rtm connectWithPduHandler:^(SatoriPdu * _Nonnull pdu) {</div><div class="line">        //Use pdu</div><div class="line">    }];</div><div class="line"></div><div class="line">// subscribe to a channel</div><div class="line">unsigned int reqId;</div><div class="line">[rtm subscribe:@&quot;channel-name&quot; andRequestId:&amp;reqId];</div><div class="line"></div><div class="line">// publish a string or json to a channel</div><div class="line">unsigned int reqId;</div><div class="line">[rtm publishString:@&quot;Hello world&quot; toChannel:@&quot;channel-name&quot; andRequestId:&amp;reqId];</div><div class="line">[rtm publishJson:@&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot; toChannel:@&quot;channel-name&quot; andRequestId:&amp;reqId];</div><div class="line"></div><div class="line">// Enable or disable verbose logging of all incoming and outgoing PDUs</div><div class="line">rtm.enableVerboseLogging = YES;</div><div class="line">rtm.enableVerboseLogging = NO;</div><div class="line"></div><div class="line">// Use wait or waitWithTimeout methods to block until at least one data message gets processed</div><div class="line">[rtm wait];</div><div class="line">[rtm waitWithTimeout:15];</div><div class="line"></div><div class="line">// For non-blocking wait, use poll</div><div class="line">while([rtm poll] &gt;= 0) { sleep(1); }</div><div class="line"></div><div class="line">// Make sure to disconnect when rtm connection is no longer needed</div><div class="line">[rtm disconnect];</div></div><!-- fragment --><h2>For Windows (Visual Studio) </h2>
<p>Assuming Visual Studio and cmake are installed, open Developer Command Prompt for Visual Studio.</p>
<div class="fragment"><div class="line">C:\satori-sdk-c&gt; mkdir vsprj</div><div class="line">C:\satori-sdk-c&gt; cd vsprj</div><div class="line">C:\satori-sdk-c\vsprj&gt; cmake -DBUILD_SHARED_LIBS=ON -G &quot;Visual Studio 14 2015&quot; ..</div><div class="line">C:\satori-sdk-c\vsprj&gt; msbuild satori-sdk-c.sln</div></div><!-- fragment --><p>Adjust the generator name from "Visual Studio 14 2015" to another if necessary.</p>
<p>For TLS support only "-DUSE_OPENSSL=ON" is supported at this time.</p>
<p>Additionally, WinSock subsystem must be initialized prior to connecting to RTM.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;WinSock2.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Windows.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;WS2tcpip.h&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">WORD wVersionRequested;</div><div class="line">WSADATA wsaData;</div><div class="line"><span class="keywordtype">int</span> err;</div><div class="line"></div><div class="line">wVersionRequested = MAKEWORD(2, 2);</div><div class="line">err = WSAStartup(wVersionRequested, &amp;wsaData);</div><div class="line"><span class="keywordflow">if</span> (err != 0) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;WSAStartup failed with code %d&quot;</span>, err);</div><div class="line">}</div></div><!-- fragment --><h1>Usage </h1>
<div class="fragment"><div class="line"><a class="code" href="rtm_8h.html#a0f68a9585c25eca96358e223d2a2f6c7">rtm_client_t</a> *rtm = (<a class="code" href="rtm_8h.html#a0f68a9585c25eca96358e223d2a2f6c7">rtm_client_t</a>*) malloc (<a class="code" href="rtm_8h.html#a96be59feb12b3e857102d136646b62d6">rtm_client_size</a>);</div><div class="line"><a class="code" href="rtm_8h.html#af70683e190e41c1823fd6aa606d59252">rtm_connect</a>(rtm, <span class="stringliteral">&quot;wss://myorg.api.satori.com/&quot;</span>, <span class="stringliteral">&quot;&lt;APPKEY&gt;&quot;</span>, <a class="code" href="rtm_8h.html#ad7e42fc880685b070f1046f6f0463978">rtm_default_pdu_handler</a>, NULL);</div><div class="line"><a class="code" href="rtm_8h.html#a9b914d942cdaf08f68091833a72da067">rtm_subscribe</a>(rtm, <span class="stringliteral">&quot;channel_a&quot;</span>, NULL);</div><div class="line"><a class="code" href="rtm_8h.html#a380bc8383bba494fd2f68f997137f9be">rtm_publish_string</a>(rtm, <span class="stringliteral">&quot;channel_a&quot;</span>, <span class="stringliteral">&quot;Hello, world&quot;</span>, NULL);</div><div class="line"><a class="code" href="rtm_8h.html#a020fe06f60e0185251136a9c29dcb8ea">rtm_publish_json</a>(rtm, <span class="stringliteral">&quot;channel_a&quot;</span>, <span class="stringliteral">&quot;{\&quot;key\&quot;:\&quot;value\&quot;, \&quot;k2\&quot;:123}&quot;</span>, NULL);</div><div class="line"><span class="keywordflow">while</span> (<a class="code" href="rtm_8h.html#a1feb331d37003f570b853342041deb59">rtm_poll</a>(rtm)&gt;=0) { sleep(1); }</div><div class="line"><a class="code" href="rtm_8h.html#a74f63635f0459af16b57f206679da285">rtm_close</a>(rtm);</div><div class="line">free(rtm);</div></div><!-- fragment --><p><code>rtm_poll(rtm)</code> can be substitued for <code>rtm_wait(rtm)</code> to avoid the sleep when there is nothing better to do. <code>while (rtm_wait(rtm)&gt;=0) {}</code></p>
<p>All channel data events go to the <code>message_handler</code> specified in the call to <code>rtm_connect</code>, other notifications, such as acknowledgements go to the <code>event_handler</code>. The default handlers simply print out to stdout.</p>
<p>In order to use RTM receipts/acknowledgements, simply provide the last argument to the <code>subscribe</code>/<code>unsubscribe</code>/<code>publish</code> functions instead of <code>NULL</code>. This argument is of type <code>unsigned int</code> and will be generated by the SDK on every function call. The generated id will be stored in the provided pointer and will eventually show in one of the <code>event_handler</code> callbacks when the acknowledgement arrives on the wire. When passing <code>NULL</code> no receipts will be generated.</p>
<p>You can use <code>rtm_get_fd(rtm)</code> to get the underlying file descriptor in order to connect to a message loop / select / poll. In such a case, simply call <code>rtm_poll(rtm)</code> whenever there is data that can be read from the socket. <code><a class="el" href="rtm_8h.html#a1feb331d37003f570b853342041deb59" title="Poll the underlying socket for any PDUs and execute the user&#39;s callbacks. ">rtm_poll()</a></code> never blocks. <code><a class="el" href="rtm_8h.html#a53f6f0a28c1b818dba50af0ac68b82c8" title="Wait for any PDUs and execute the user&#39;s callbacks. ">rtm_wait()</a></code> is a blocking alternative to <code><a class="el" href="rtm_8h.html#a1feb331d37003f570b853342041deb59" title="Poll the underlying socket for any PDUs and execute the user&#39;s callbacks. ">rtm_poll()</a></code> which blocks until at least one data message gets processed. Use it if you have nothing better to do. <code>rtm_publish_*()</code> may block if the network blocks. <code><a class="el" href="rtm_8h.html#af70683e190e41c1823fd6aa606d59252" title="Initialize an instance of rtm_client_t and connects to RTM. ">rtm_connect()</a></code> will block until the connection handshake is complete. You can set the global <code>rtm_connect_timeout</code> to the maximum number of seconds to wait for the connection handshake to complete.</p>
<p>A global error handler can be set by setting <code>rtm_error_logger</code> to any function that takes a <code>const char* msg</code>. The default one prints errors to stderr.</p>
<h1>Verbose logging of all incoming and outcoming PDUs </h1>
<p>You can enable dumping of all PDUs to stderr either from your code::</p>
<p>rtm_connect(rtm, ...); rtm_enable_verbose_logging(rtm);</p>
<p>or by setting DEBUG_SATORI_SDK environment variable prior to running your application::</p>
<p>export DEBUG_SATORI_SDK=1 ./my_program</p>
<h1>Missing functionality </h1>
<ul>
<li>Handling of network errors is left to the user</li>
<li>Providing access to the <code>position</code> in RTM messages (and during subscription) </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
