<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTM Core SDK: C SDK for Satori RTM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
     <a class="page-logo-link" href="https://www.satori.com" style="cursor: pointer;">
       <img alt="Satori"
            class="page-logo-image"
            height="30"
            src="https://www.satori.com/assets/images/logo-light@2x.png"
            width="177"
       />
     </a>
     RTM Core SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C SDK for Satori RTM </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This C SDK is a lightweight SDK:</p><ul>
<li>It has no external dependencies, in particular it does not require a JSON library</li>
<li>It does not lock you into using any threading or event loop framework, but is ready to be used in any of those</li>
<li>Does not allocate memory dynamically. All message processing is done in-place</li>
<li>Has less features than other Satori RTM SDKs, e.g. it has no auto-reconnection</li>
<li>Is likely to be used as a base for building higher-level SDKs (see ios-wrapper for example)</li>
</ul>
<h1>Build </h1>
<h2>For desktop/server </h2>
<p>The build system is using <a href="https://cmake.org/">cmake</a>.</p>
<p>Supported compilers:</p><ul>
<li>Microsoft Visual Studio 2015 or newer</li>
<li>gcc-4.9 or newer</li>
<li>clang-3.6 or newer</li>
</ul>
<p>To build, just execute: </p><div class="fragment"><div class="line">$ mkdir build &amp;&amp; cd build</div><div class="line">$ cmake ..</div><div class="line">$ cmake --build .</div></div><!-- fragment --><p>To compile with support for the unit tests, first you need to create a credentials.json file in the base directory:</p>
<div class="fragment"><div class="line">$ cat credentials.json</div><div class="line">{</div><div class="line">  &quot;endpoint&quot;: &quot;wss://&lt;SATORI_HOST&gt;/&quot;,</div><div class="line">  &quot;appkey&quot;: &quot;my_appkey&quot;,</div><div class="line">  &quot;auth_role_name&quot;: &quot;ROLE NAME&quot;</div><div class="line">  &quot;auth_role_secret_key&quot;: &quot;ROLE SECRET&quot;</div><div class="line">  &quot;auth_restricted_channel&quot;: &quot;RESTRICTED CHANNEL&quot;</div><div class="line">}</div></div><!-- fragment --><ul>
<li><code>endpoint</code> is your customer-specific DNS name for RTM access.</li>
<li><code>appkey</code> is your application key.</li>
<li><code>auth_role_name</code> is a role name that permits publishing / subscribing to <code>auth_restricted_channel</code>. Must be not <code>default</code>.</li>
<li><code>auth_role_secret_key</code> is a secret key for <code>auth_role_name</code>.</li>
<li><code>auth_restricted_channel</code> is a channel with subscribe and publish access for <code>auth_role_name</code> role only.</li>
</ul>
<p>You must use <a href="https://developer.satori.com/">DevPortal</a> to create role and set channel permissions.</p>
<p>To then build with support for tests, execute: </p><div class="fragment"><div class="line">$ mkdir build &amp;&amp; cd build</div><div class="line">$ cmake .. -DTESTS=1</div><div class="line">$ cmake --build .</div></div><!-- fragment --><p>After that, execute: </p><div class="fragment"><div class="line">$ ./core/test/rtm_unit_tests</div></div><!-- fragment --><h2>As an external project </h2>
<p>If your project is also built using CMake, you can take advantage of its ExternalProject feature. This way downloading and building the SDK is automated by CMake itself.</p>
<h2>ESP8266/Arduino support </h2>
<p>The SDK can generate a library for use with Arduino on ESP8266 platforms. Pass "-DARDUINO-SDK=ON" to CMake to generate a ZIP file that can be imported into Arduino. You can download a prebuilt library from the releases page on Github. Import it into Arduino using <b>Sketch</b> → <b>Include Library</b> → <b>Add .ZIP library</b>.</p>
<h2>TLS support </h2>
<p>The SDK requires either OpenSSL, GNUTLS or Apple SSL. Pass one of "-DUSE_OPENSSL=ON", "-DUSE_GNUTLS=ON" or "-DUSE_APPLE_SSL=ON" respectively to CMake.</p>
<p>If no flags are passed, CMake enables Apple SSL for Mac, and for others uses OpenSSL or GnuTLS if OpenSSL is not installed.</p>
<h2>iOS wrapper</h2>
<p>The SatoriRtmSdkWrapper framework for iOS enables you to integrate your iOS apps with Satori RTM. Using the framework, you can publish and subscribe messages to RTM. There are multiple ways for installing the SatoriRtmSdkWrapper framework in your own project.</p>
<h3>Installation with CocoaPods</h3>
<p>The SatoriRtmSdkWrapper is available as a <a href="http://cocoapods.org">CocoaPod</a>. Cocoapod is a dependency manager for iOS, which automates and simplifies the process of using 3rd-party frameworks like SatoriRtmSdkWrapper in your projects. Make sure cocoapods is installed. Then create a podfile for your project if it doesn't already exist. To install the SDK:</p>
<ol type="1">
<li>Open your Podfile and add the following dependency in the <code>target "&lt;your_app_target&gt;" do</code> section: <div class="fragment"><div class="line">use_frameworks!</div><div class="line">pod &#39;SatoriRtmSdkWrapper&#39;, :git =&gt; &quot;https://github.com/satori-com/satori-rtm-sdk-c.git&quot;</div></div><!-- fragment --></li>
<li>Save your Podfile.</li>
<li>Run <code>pod install</code> from command line.</li>
</ol>
<p>You've now installed the SatoriRtmSdkWrapper framework. Refer to <em>Framework API usage</em> section to get started.</p>
<h3>Manual installation using Source code</h3>
<p>Create a local repository by cloning the satori-rtm-sdk-c to your chosen location. Then,</p>
<h4>Step 1: Build locally</h4>
<p>Follow the normal installation procedure to build the desktop / server variant of the SDK. This will create a configuration header in the build directory which is used during compilation of the iOS framework.</p>
<h4>Step 2: Build framework</h4>
<p>There are two options to build the RTM framework for iOS:</p>
<p><b>Option 1</b> - <em>Build directly from command-line</em></p>
<div class="fragment"><div class="line">$ cd ios-wrapper/SatoriRtmSdkWrapper</div><div class="line">$ xcodebuild -project SatoriRtmSdkWrapper.xcodeproj -scheme SatoriRtmSdkWrapper-Universal -config &lt;config-name&gt; # where &lt;config-name&gt; can be Debug or Release. Default is Debug if -config option is not specified.</div></div><!-- fragment --><p> <b>Option 2</b> - <em>Build in Xcode IDE</em> </p><div class="fragment"><div class="line">$ open SatoriRtmSdkWrapper.xcodeproj</div></div><!-- fragment --><p>Select SatoriRtmSdkWrapper-Universal target and build.</p>
<p>The SatoriRtmSdkWrapper.framework will be built under ios-wrapper/build directory.</p>
<h4>Step 3: Add framework to your project</h4>
<p>Once you build the framework, open your app's Xcode project and drag-and-drop the framework under "Embedded Binaries" section under the app's target. Choose "Copy items if needed" and "Create groups" in the dialog box.</p>
<h3>Framework API usage</h3>
<p>The SatoriRtmSdkWrapper.framework provides you with both Objective-C and C APIs to integrate within your app. Use <code>#import &lt;SatoriRtmSdkWrapper/SatoriRtmSdkWrapper.h&gt;</code> in your application class to make use of these APIs. The Objective-C specific APIs are located in <code>SatoriRtmConnection.h</code> and C APIs can be found in <code><a class="el" href="rtm_8h.html" title="RTM CORE SDK documentation. ">rtm.h</a></code></p>
<h5>Objective-C Sample Code</h5>
<div class="fragment"><div class="line">// create a new rtm instance with url and appKey</div><div class="line">SatoriRtmConnection *rtm = [[SatoriRtmConnection alloc] initWithUrl:&quot;url&quot; andAppkey:&quot;appkey&quot;];</div><div class="line"></div><div class="line">// connect to rtm and provide pdu data handler block</div><div class="line">rtm_status status = [rtm connectWithPduHandler:^(SatoriPdu * _Nonnull pdu) {</div><div class="line">        //Use pdu</div><div class="line">    }];</div><div class="line"></div><div class="line">// subscribe to a channel</div><div class="line">unsigned int reqId;</div><div class="line">[rtm subscribe:@&quot;channel-name&quot; andRequestId:&amp;reqId];</div><div class="line"></div><div class="line">// publish a string or json to a channel</div><div class="line">unsigned int reqId;</div><div class="line">[rtm publishString:@&quot;Hello world&quot; toChannel:@&quot;channel-name&quot; andRequestId:&amp;reqId];</div><div class="line">[rtm publishJson:@&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot; toChannel:@&quot;channel-name&quot; andRequestId:&amp;reqId];</div><div class="line"></div><div class="line">// Enable or disable verbose logging of all incoming and outgoing PDUs</div><div class="line">rtm.enableVerboseLogging = YES;</div><div class="line">rtm.enableVerboseLogging = NO;</div><div class="line"></div><div class="line">// Use wait or waitWithTimeout methods to block until at least one data message gets processed</div><div class="line">[rtm wait];</div><div class="line">[rtm waitWithTimeout:15];</div><div class="line"></div><div class="line">// For non-blocking wait, use poll</div><div class="line">while([rtm poll] &gt;= 0) { sleep(1); }</div><div class="line"></div><div class="line">// Make sure to disconnect when rtm connection is no longer needed</div><div class="line">[rtm disconnect];</div></div><!-- fragment --><h2>For Windows (Visual Studio) </h2>
<p>Assuming Visual Studio and cmake are installed, open Developer Command Prompt for Visual Studio.</p>
<div class="fragment"><div class="line">C:\satori-rtm-sdk-c&gt; mkdir vsprj</div><div class="line">C:\satori-rtm-sdk-c&gt; cd vsprj</div><div class="line">C:\satori-rtm-sdk-c\vsprj&gt; cmake -DBUILD_SHARED_LIBS=ON -G &quot;Visual Studio 14 2015&quot; ..</div><div class="line">C:\satori-rtm-sdk-c\vsprj&gt; msbuild satori-sdk-c.sln</div></div><!-- fragment --><p>Adjust the generator name from "Visual Studio 14 2015" to another if necessary.</p>
<p>For TLS support only "-DUSE_OPENSSL=ON" is supported at this time.</p>
<p>To compile with OpenSSL you need to:</p><ol type="1">
<li>Download and install the appropriate distribution from <a href="https://slproweb.com/products/Win32OpenSSL.html">https://slproweb.com/products/Win32OpenSSL.html</a></li>
<li>Update your project properties to add additional include folders (pointing to the above install location)</li>
<li>Update project properties to refer to library path of the above installation</li>
<li>Add OpenSSL library files to your linker input libraries. The names for those depend on OpenSSL version: libssl.lib and libcrypto.lib for 1.1.x and libeay.lib and ssleay.lib for 1.0.x. There also could be some variations in naming like ssleay32MD.lib depending on the OpenSSL distribution.</li>
</ol>
<p>Additionally, WinSock subsystem must be initialized prior to connecting to RTM.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;WinSock2.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Windows.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;WS2tcpip.h&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">WORD wVersionRequested;</div><div class="line">WSADATA wsaData;</div><div class="line"><span class="keywordtype">int</span> err;</div><div class="line"></div><div class="line">wVersionRequested = MAKEWORD(2, 2);</div><div class="line">err = WSAStartup(wVersionRequested, &amp;wsaData);</div><div class="line"><span class="keywordflow">if</span> (err != 0) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;WSAStartup failed with code %d&quot;</span>, err);</div><div class="line">}</div></div><!-- fragment --><h1>Usage </h1>
<p>This is an example subscriber program:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rtm_8h.html">rtm.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *endpoint = <span class="stringliteral">&quot;YOUR_ENDPOINT&quot;</span>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *appkey = <span class="stringliteral">&quot;YOUR_ENDPOINT&quot;</span>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *channel = <span class="stringliteral">&quot;YOUR_CHANNEL&quot;</span>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> pdu_handler(<a class="code" href="structrtm__client.html">rtm_client_t</a> *rtm, <a class="code" href="struct__rtm__pdu.html">rtm_pdu_t</a> <span class="keyword">const</span> *pdu) {</div><div class="line">    <span class="keywordflow">switch</span> (pdu-&gt;action) {</div><div class="line">        <span class="keywordflow">case</span> RTM_ACTION_SUBSCRIPTION_DATA: {</div><div class="line">            <span class="keywordtype">char</span> *message;</div><div class="line">            <span class="keywordflow">while</span> ((message = <a class="code" href="rtm_8h.html#a065f39d8529968def798008c928f8353">rtm_iterate</a>(&amp;pdu-&gt;message_iterator))) {</div><div class="line">                printf(<span class="stringliteral">&quot;Got message %s\n&quot;</span>, message);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> RTM_ACTION_SUBSCRIBE_OK: {</div><div class="line">            printf(<span class="stringliteral">&quot;Successfully subscribed to %s\n&quot;</span>, channel);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div><div class="line">    <span class="keywordtype">void</span> *memory = malloc(<a class="code" href="rtm_8h.html#a96be59feb12b3e857102d136646b62d6">rtm_client_size</a>);</div><div class="line">    <a class="code" href="structrtm__client.html">rtm_client_t</a> *rtm = <a class="code" href="rtm_8h.html#a749eeb668d1e3b8088a24df19f2dbd31">rtm_init</a>(memory, pdu_handler, 0);</div><div class="line">    <span class="keywordtype">int</span> rc = <a class="code" href="rtm_8h.html#a7ea7668c0cedee2e5eac4959ac957ee6">rtm_connect</a>(rtm, endpoint, appkey);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (rc != <a class="code" href="rtm_8h.html#a14c1c9f22306549de95a3d4117da124ba817168c8511df43249b5ccf5ac47f8f9">RTM_OK</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;rtm_connect failed with status %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">goto</span> cleanup;</div><div class="line">    }</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Connected to RTM!\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ack_id;</div><div class="line">    rc = <a class="code" href="rtm_8h.html#a9b914d942cdaf08f68091833a72da067">rtm_subscribe</a>(rtm, channel, &amp;ack_id);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (rc != <a class="code" href="rtm_8h.html#a14c1c9f22306549de95a3d4117da124ba817168c8511df43249b5ccf5ac47f8f9">RTM_OK</a>) {</div><div class="line">        printf(<span class="stringliteral">&quot;rtm_subscribe failed with status %d\n&quot;</span>, rc);</div><div class="line">        <span class="keywordflow">goto</span> cleanup;</div><div class="line">    }</div><div class="line"></div><div class="line">    rc = <a class="code" href="rtm_8h.html#afbb999f37ed9b5d74e22f93efef34311">rtm_wait_timeout</a>(rtm, 10 <span class="comment">/* seconds */</span>);</div><div class="line">    <span class="keywordflow">if</span> (rc != <a class="code" href="rtm_8h.html#a14c1c9f22306549de95a3d4117da124ba817168c8511df43249b5ccf5ac47f8f9">RTM_OK</a>) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to receive subscribe reply\n&quot;</span>);</div><div class="line">        <span class="keywordflow">goto</span> cleanup;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(1) {</div><div class="line">        rc = <a class="code" href="rtm_8h.html#afbb999f37ed9b5d74e22f93efef34311">rtm_wait_timeout</a>(rtm, 10 <span class="comment">/* seconds */</span>);</div><div class="line">        <span class="keywordflow">if</span> (rc != <a class="code" href="rtm_8h.html#a14c1c9f22306549de95a3d4117da124ba817168c8511df43249b5ccf5ac47f8f9">RTM_OK</a> &amp;&amp; rc != <a class="code" href="rtm_8h.html#a14c1c9f22306549de95a3d4117da124ba9a34332eba483965424a1e3909bf06ee">RTM_ERR_TIMEOUT</a>) {</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;Failed to receive a message from channel\n&quot;</span>);</div><div class="line">            <span class="keywordflow">goto</span> cleanup;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">cleanup:</div><div class="line">    <a class="code" href="rtm_8h.html#a74f63635f0459af16b57f206679da285">rtm_close</a>(rtm);</div><div class="line">    free(rtm);</div><div class="line">    <span class="keywordflow">return</span> rc;</div><div class="line">}</div></div><!-- fragment --><p>To learn more, look at tutorial and core/examples directories and visit <a href="https://www.satori.com/docs">documentation page</a>.</p>
<h1>Verbose logging of all incoming and outcoming PDUs </h1>
<p>You can enable dumping of all PDUs to stderr either from your code::</p>
<div class="fragment"><div class="line">rtm_client_t *rtm = rtm_init(...);</div><div class="line">rtm_enable_verbose_logging(rtm);</div></div><!-- fragment --><p>or by setting DEBUG_SATORI_SDK environment variable prior to running your application::</p>
<div class="fragment"><div class="line">export DEBUG_SATORI_SDK=1</div><div class="line">./my_program</div></div><!-- fragment --><h1>Using https proxy </h1>
<p>The SDK supports working through an https (not http) proxy.</p>
<p>Instead of calling <code>rtm_connect</code> use <code>rtm_connect_via_https_proxy</code> that additionally takes <code>proxy_host</code> and <code>proxy_port</code> like this:</p>
<div class="fragment"><div class="line">rtm_client_t *client = rtm_init(memory, &amp;pdu_handler, &amp;my_state);</div><div class="line">rtm_connect_via_https_proxy(client, &quot;YOUR_ENDPOINT&quot;, &quot;YOUR_APPKEY&quot;, &quot;http://127.0.0.1:7711&quot;);</div></div><!-- fragment --><h1>Migrating from C Core SDK v1 </h1>
<p>See Migration notes</p>
<h1>Missing functionality </h1>
<ul>
<li>Handling of network errors is left to the user </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
